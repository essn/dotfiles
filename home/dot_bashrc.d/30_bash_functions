#!/usr/bin/env bash

# Yazi file manager wrapper
function y() {
	local tmp="$(mktemp -t "yazi-cwd.XXXXXX")" cwd
	yazi "$@" --cwd-file="$tmp"
	IFS= read -r -d '' cwd < "$tmp"
	[ -n "$cwd" ] && [ "$cwd" != "$PWD" ] && builtin cd -- "$cwd"
	rm -f -- "$tmp"
}

# Create a directory and cd into it
function mkcd() {
	if [ $# -eq 0 ]; then
		echo "Usage: mkcd <directory>"
		return 1
	fi
	mkdir -p "$1" && cd "$1"
}

# Create a timestamped backup of a file or directory
function backup() {
	if [ $# -eq 0 ]; then
		echo "Usage: backup <file|directory>"
		return 1
	fi
	local timestamp=$(date +%Y%m%d_%H%M%S)
	local backup_name="${1}.backup_${timestamp}"
	cp -r "$1" "$backup_name" && echo "Backup created: $backup_name"
}

# Extract common archive formats
function extract() {
	if [ $# -eq 0 ]; then
		echo "Usage: extract <archive_file>"
		return 1
	fi

	if [ ! -f "$1" ]; then
		echo "Error: '$1' is not a valid file"
		return 1
	fi

	case "$1" in
		*.tar.bz2)   tar xjf "$1"     ;;
		*.tar.gz)    tar xzf "$1"     ;;
		*.tar.xz)    tar xJf "$1"     ;;
		*.bz2)       bunzip2 "$1"     ;;
		*.gz)        gunzip "$1"      ;;
		*.tar)       tar xf "$1"      ;;
		*.tbz2)      tar xjf "$1"     ;;
		*.tgz)       tar xzf "$1"     ;;
		*.zip)       unzip "$1"       ;;
		*.Z)         uncompress "$1"  ;;
		*.7z)        7z x "$1"        ;;
		*.rar)       unrar x "$1"     ;;
		*)           echo "Error: '$1' cannot be extracted via extract()"; return 1 ;;
	esac
}

# Find files by name in current directory
function ff() {
	if [ $# -eq 0 ]; then
		echo "Usage: ff <pattern>"
		return 1
	fi

	if command -v fd &> /dev/null; then
		fd --type f "$1"
	else
		find . -type f -iname "*$1*"
	fi
}
